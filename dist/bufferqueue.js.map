{"version":3,"file":"bufferqueue.js","sources":["../src/Queue.js","../src/PriorityQueue.js","../src/EventManager.js","../src/Tools.js","../src/BufferQueue.js","../src/index.js"],"sourcesContent":["/**\n * A queue to add and pop string. It also provides an arbitrary remove function.\n * A queue is first-in-first-out.\n * Elements in this queue must be strings\n */\nclass Queue {\n\n  constructor() {\n    this._q = []\n    // this is to support the has function in constant time\n    this._keys = {}\n  }\n\n\n  /**\n   * Add a string at the end of the queue. Not added again if already in there.\n   * @param {string} str - some string to add\n   */\n  add(str) {\n    if (!(str in this._keys)){\n      this._q.unshift(str)\n      this._keys[str] = 1\n    }\n  }\n\n\n  /**\n   * Check if this queue contains a given string\n   * @return {boolean} true if this queue has a given string, false if not\n   */\n  has(str) {\n    return (str in this._keys)\n  }\n\n\n  /**\n   * Extract the first element\n   * @return {string} the first element\n   */\n  pop() {\n    let str = null\n    if(this._q.length){\n      str = this._q.pop()\n      delete this._keys[str]\n    }\n    return str\n  }\n\n\n  /**\n   * Is the queue empty?\n   * @return {boolean} true if empty, false if not\n   */\n  isEmpty() {\n    return !this._q.length\n  }\n\n\n  /**\n   * Get the number of element in the queue\n   * @param {number}\n   */\n  size() {\n    return this._q.length\n  }\n\n\n  /**\n   * Get the first element of the queue without removing it\n   * (Not sure how useful is that)\n   * @return {string}\n   */\n  first() {\n    return this._q.length ? this._q[0] : null\n  }\n\n\n  /**\n   * Get the last element of the queue without removing it\n   * (Not sure how useful is that)\n   * @return {string}\n   */\n  last() {\n    return this._q.length ? this._q[this._q.length - 1] : null\n  }\n\n\n  /**\n   * Remove an element from the queue and returns it\n   * @param {string} str - an element to remove\n   * @return {string | null}\n   */\n  remove(str) {\n    let strToRem = null\n    let index = this._q.indexOf(str)\n    if (index > -1) {\n      strToRem = this._q.splice(index, 1)\n      delete this._keys[strToRem]\n    }\n    return strToRem\n  }\n\n\n  /**\n   * Remove all the elements of the queue\n   */\n  reset() {\n    this._q = []\n    this._keys = {}\n  }\n\n}\n\n\nexport default Queue\n","import Queue from './Queue'\n\n/**\n * This priority queue works with levels of priority, 0 beeing the highest priority\n * and following level will be of decreasing priority.\n * In term of implementation, PriorityQueue instanciates N Queues, where N is the\n * number of priority levels. The number of priority levels has to be given at\n * the creation of a PriorityQueue instance.\n */\nclass PriorityQueue {\n  constructor(levels=3) {\n    this._qs = Array.from({length: levels}, () => new Queue())\n    this._probabilityMap = new Array(levels)\n    this._makeProbabilityMap()\n  }\n\n  _makeProbabilityMap() {\n    let levels = this._qs.length\n    let factors = Array.from({length: levels}, (x, i) => 1/Math.pow(2,i))\n    let factorSum = factors.reduce((acc, x) => acc + x)\n\n    for(let i=0; i<levels; i++) {\n      this._probabilityMap[i] = factors[i] / factorSum\n\n      if (i>0) {\n        this._probabilityMap[i] += this._probabilityMap[i-1]\n      }\n    }\n\n    console.log(this._probabilityMap)\n  }\n\n  /**\n   * Get the level of priority of a given string\n   * @return {number} zero is the highest priority, -1 means the element is NOT\n   * in the queue\n   */\n  getPriority(str) {\n    for(let i=0; i<this._qs.length; i++) {\n      if(this._qs[i].has(str)){\n        return i\n      }\n    }\n    return -1\n  }\n\n\n  /**\n   * Checks if a string is in the queue. Optionally, we can verify a specific\n   * level only.\n   * @param {string} str - string to verify the presence in the queue\n   * @param {number} priority - OPTIONAL the priority (must be in [0, level-1])\n   * @return {boolean}\n   */\n  has(str, priority=-1) {\n    if(~priority) {\n      return this._qs[priority].has(str)\n    }\n\n    for(let i=0; i<this._qs.length; i++) {\n      if(this._qs[i].has(str)){\n        return true\n      }\n    }\n    return false\n  }\n\n\n  /**\n   * Add a string to the queue with a given priority.\n   * If the string is already present in the queue with the same level of priority or higher, then nothing is done.\n   * If the string is already present but with a different level of priority, then\n   * it is removed and added with the provided level or priority.\n   * @param {string} str - the string to add\n   * @param {number} priority - the priority (must be in [0, level-1])\n   * @param {boolean} true if added, false if not (because already in with a higher priority)\n   */\n  add(str, priority) {\n    let existingPriority = this.getPriority(str)\n\n    if(existingPriority >= priority) {\n      return false\n    }\n\n    if(existingPriority) {\n      this.remove(str)\n    }\n\n    this._qs[priority].add(str)\n    return true\n  }\n\n\n  /**\n   * Get the the element with the highest priority and remove it from the queue\n   * @return {string|null} can return null if the queue is empty\n   */\n  pop_ORIG() {\n    for(let i=0; i<this._qs.length; i++) {\n      if(!this._qs[i].isEmpty()) {\n        return this._qs[i].pop()\n      }\n    }\n\n    return null\n  }\n\n\n  /**\n   * This version of pop relies on the probability map to make sure that some lower\n   * priorities items are getting popped every now and then, even if there are still\n   * elements in higher priority queues\n   */\n  pop() {\n    if(this.isEmpty()){\n      return null\n    }\n\n    // if the first(s) priorities are empty, we dont want to have the random seed\n    // within their range, so we pad if to make sure it lands in an area corresponding\n    // to some non-empty priority level\n    let probPadding = 0\n\n    for(let i=0; i<this._qs.length; i++){\n      if(this._qs[i].isEmpty()){\n        probPadding = this._probabilityMap[i]\n      } else if(probPadding !== 0) {\n        // in case we have empty, non-empty, empty. We want to stop at the first non-empty\n        break\n      }\n    }\n\n    let seed = probPadding + Math.random() * (1 - probPadding)\n    let levelToPop = 0\n\n    // check the level corresponding to the seed\n    for(let i=0; i<this._qs.length; i++){\n      if(seed < this._probabilityMap[i]) {\n        levelToPop = i\n        break\n      }\n    }\n\n    // if the seeded level is empty,\n    // we pop the one of higher priority that is non-empty\n    if(this._qs[levelToPop].isEmpty()) {\n      for(let i=levelToPop; i==0; i--) {\n        if(!this._qs[i].isEmpty()) {\n          return this._qs[i].pop()\n        }\n      }\n    }\n\n    return this._qs[levelToPop].pop()\n  }\n\n\n  /**\n   * Check if the priority queue is empty (= if all the per-level-queues are all empty)\n   * @return {boolean} true if empty, false if not empty\n   */\n  isEmpty() {\n    return this._qs.every(q => q.isEmpty())\n  }\n\n\n  /**\n   * Get the total number of elements in the priority queue, or optionnaly, for a specific\n   * level of priority\n   * @param {number} priority - OPTIONAL level of priority\n   * @param {number} number of elements\n   */\n  size(priority = -1) {\n    if(~priority) {\n      return this._qs[priority].size()\n    }\n\n    let s = 0\n    for(let i=0; i<this._qs.length; i++) {\n      s += this._qs[i].size()\n    }\n    return s\n  }\n\n\n  /**\n   * Get the size of the queue for each priority level\n   * @return {array}\n   */\n  sizePerPriority() {\n    return this._qs.map(q => q.size())\n  }\n\n\n  /**\n   * Note: this should be used as rarely as possible since it does not respect the logic\n   * of a queue.\n   * Remove an element. If null is returned, this means the element was not in the queue.\n   * @param {string} - str, the element to remove\n   * @return {string|null} the element that was jsut removed\n   */\n  remove(str) {\n    let elem = null\n    for(let i=0; i<this._qs.length; i++) {\n      elem = elem || this._qs[i].remove(str)\n    }\n    return elem\n  }\n\n\n  /**\n   * Reset the whole priority queue, empty it all. No value returned.\n   */\n  reset() {\n    for(let i=0; i<this._qs.length; i++) {\n      this._qs[i].reset()\n    }\n  }\n\n}\n\nexport default PriorityQueue\n","/**\n * The EventManager deals with events, create them, call them.\n * This class is mostly for being inherited from.\n */\nclass EventManager {\n  /**\n   * Constructor\n   */\n  constructor() {\n    this._events = {}\n  }\n\n\n  /**\n   * Define an event, with a name associated with a function\n   * @param  {String} eventName - Name to give to the event\n   * @param  {Function} callback - function associated to the even\n   */\n  on(eventName, callback) {\n    if (typeof callback === 'function') {\n      if (!(eventName in this._events)) {\n        this._events[eventName] = []\n      }\n      this._events[eventName].push(callback)\n    } else {\n      console.warn('The callback must be of type Function')\n    }\n  }\n\n\n  emit(eventName, args = []) {\n    // the event must exist and be non null\n    if ((eventName in this._events) && (this._events[eventName].length > 0)) {\n      const events = this._events[eventName]\n      for (let i = 0; i < events.length; i += 1) {\n        events[i](...args)\n      }\n    } else {\n      console.warn(`No function associated to the event ${eventName}`)\n    }\n  }\n}\n\nexport default EventManager\n","/**\n * Handy function to deal with option object we pass in argument of function.\n * Allows the return of a default value if the `optionName` is not available in\n * the `optionObj`\n * @param {Object} optionObj - the object that contain the options\n * @param {String} optionName - the name of the option desired, attribute of `optionObj`\n * @param {any} optionDefaultValue - default values to be returned in case `optionName` is not an attribute of `optionObj`\n */\nexport function getOption(optionObj, optionName, optionDefaultValue) {\n  return (optionObj && optionName in optionObj) ? optionObj[optionName] : optionDefaultValue\n}\n","import PriorityQueue from './PriorityQueue'\nimport EventManager from './EventManager'\nimport { getOption } from './Tools'\n\n\n/**\n *\n *\n * Emitted events:\n * - 'added': when a new element to download is added to the queue\n * - 'removed': when an element is removed (and will not be downloaded)\n * - 'reseted': when the whole queue is reseted\n * - 'downloading': when a file is starting to be downloading (after being popped from the queue)\n * - 'failed': when a file could not be downloaded properly (status above 2xx)\n * - 'aborted': when a file download is aborted by an explicit abort() call\n * - 'success': when a file has been successfully downloaded and converted into an ArrayBuffer\n *\n */\nclass BufferQueue extends EventManager {\n\n  /**\n   * @param {Object} options - the option object\n   * @param {number} options.priorityLevels - Number of levels of priority to have in the priority queue (default: 3)\n   * @param {number} options.concurentDownloads - number of concurent downloads possible (default: 4)\n   * @param {Headers} options.httpSettings - the optional settings for the HTTP request (default: {}) see 'init' object from https://developer.mozilla.org/en-US/docs/Web/API/Request/Request\n   */\n  constructor(options) {\n    super()\n    this._concurentDownloads = getOption(options, 'concurentDownloads', 4)\n    this._pq = new PriorityQueue(getOption(options, 'priorityLevels', 3))\n    this._httpSettings = getOption(options, 'httpSettings', {})\n    this._dlControllers = {} // keeps the 'signal' and tracks which files are currently being downloaded\n  }\n\n\n  /**\n   * Get the level of priority of a given string\n   * @return {number} zero is the highest priority, -1 means the element is NOT\n   * in the queue\n   */\n  getPriority(str) {\n    return this._pq.getPriority(str)\n  }\n\n\n  /**\n   * Checks if a string is in the queue. Optionally, we can verify a specific\n   * level only.\n   * @param {string} str - string to verify the presence in the queue\n   * @param {number} priority - OPTIONAL the priority (must be in [0, level-1])\n   * @return {boolean}\n   */\n  has(str, priority=-1) {\n    return this._pq.has(str, priority)\n  }\n\n\n  /**\n   * Add a string to the queue with a given priority.\n   * If the string is already present in the queue with the same level of priority or higher, then nothing is done.\n   * If the string is already present but with a different level of priority, then\n   * it is removed and added with the provided level or priority.\n   *\n   * Emits the event 'added' with the str as argument if properly added.\n   *\n   * @param {string} str - the string to add\n   * @param {number} priority - the priority (must be in [0, level-1])\n   * @param {boolean} true if added, false if not (because already in with a higher priority)\n   */\n  add(str, priority) {\n    if(this._pq.add(str, priority)){\n      this.emit('added', [str, priority])\n      this._tryNext()\n    }\n  }\n\n\n  /**\n   * Check if the priority queue is empty (= if all the per-level-queues are all empty)\n   * @return {boolean} true if empty, false if not empty\n   */\n  isEmpty() {\n    return this._pq.isEmpty()\n  }\n\n\n  /**\n   * Get the total number of elements in the priority queue, or optionnaly, for a specific\n   * level of priority\n   * @param {number} priority - OPTIONAL level of priority\n   * @param {number} number of elements\n   */\n  size() {\n    return this._pq.size()\n  }\n\n\n  /**\n   * Get the size of the queue for each priority level\n   * @return {array}\n   */\n  sizePerPriority() {\n    return this._pq.sizePerPriority()\n  }\n\n\n  /**\n   * Note: this should be used as rarely as possible since it does not respect the logic\n   * of a queue.\n   * Remove an element. If null is returned, this means the element was not in the queue.\n   *\n   * Emits the event 'removed' if the str as argument if properly removed\n   *\n   * @param {string} - str, the element to remove\n   * @return {string|null} the element that was jsut removed\n   */\n  remove(str){\n    if(this._pq.remove(str)) {\n      this.emit('removed', [str])\n    }\n  }\n\n\n  /**\n   * Reset the whole priority queue, empty it all. No value returned.\n   *\n   * Emits the event 'reseted' without any argument\n   */\n  reset() {\n    this._pq.reset()\n    this._dlControllers = {}\n    this.emit('reseted', [])\n  }\n\n\n  abort(str) {\n    // TODO\n    if(str in this._dlControllers) {\n      this._dlControllers[str].abort()\n    }\n  }\n\n\n  abortAll() {\n    let k = Object.keys(this._dlControllers)\n    for(let i=0; i<k.length; i++) {\n      this._dlControllers[k[i]].abort()\n    }\n  }\n\n\n  /**\n   *\n   *\n   */\n  // start() {\n  //   this._tryNext()\n  // }\n\n\n  _tryNext() {\n    let nbCurrentDl = Object.keys(this._dlControllers).length\n    if(nbCurrentDl >= this._concurentDownloads)\n      return\n\n    let toBeDl = this._pq.pop()\n\n    if(toBeDl) {\n      this._startDownload(toBeDl)\n    }\n  }\n\n\n  _startDownload(str){\n    let that = this\n\n\n    let myRequest = new Request(str ,this._httpSettings)\n\n    //let signal = new AbortController()\n    //this._dlControllers[str] = signal\n    this._dlControllers[str] = myRequest.signal\n\n    this.emit('downloading', [str])\n\n    fetch(myRequest/*, { signal }*/).then(response => {\n      if(!response.ok){\n        that.emit('failed', [url, response])\n        return null\n      }\n      return response.blob()\n    }).then(myBlob => {\n      delete that._dlControllers[str]\n\n      if(!myBlob)\n        return\n\n      let fileReader = new FileReader()\n      fileReader.onload = function(event) {\n        let buf = event.target.result\n        that._tryNext()\n        that.emit('success', [str, buf])\n      }\n      fileReader.readAsArrayBuffer(myBlob)\n    }).catch(function(err) {\n      delete that._dlControllers[str]\n      that._tryNext()\n\n      if(err.code === 20){\n        that.emit('aborted', [str])\n      } else {\n        that.emit('failed', [str, err])\n      }\n    })\n  }\n\n\n\n}\n\nexport default BufferQueue\n","import BufferQueue from './BufferQueue'\n\nexport default ({\n  BufferQueue\n}) \n"],"names":[],"mappings":"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"}